<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="강동구 마스크 재고 알리미">
    <meta property="og:description" content="강동구 지역 마스크 재고 및 코로나 관련 정보를 알려주는 사이트 입니다.">
    <meta property="og:image" content="img\image.png">
    <meta preperty="og:url" content="http://gangdong-corona.co.kr">

    <meta property="twitter:card" content="summary">
    <meta property="twitter:title" content="강동구 마스크 재고 알리미">
    <meta property="twitter:description" content="강동구 지역 마스크 재고 및 코로나 관련 정보를 알려주는 사이트 입니다.">
    <meta property="twitter:image" content="img\image.png">
    <meta preperty="twitter:domain" content="http://gangdong-corona.co.kr">

    <meta property="instargram:card" content="summary">
    <meta property="instargram:title" content="강동구 마스크 재고 알리미">
    <meta property="instargram:description" content="강동구 지역 마스크 재고 및 코로나 관련 정보를 알려주는 사이트 입니다.">
    <meta property="instargram:image" content="img\image.png">
    <meta preperty="instargram:domain" content="http://gangdong-corona.co.kr">

    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <title>강동구 코로나 - 마스크</title>
    <link rel="stylesheet" href="css\style1.css">
    <link rel="shortcut icon" href="img\favicon.ico">

</head>

<body>

    <!-- 팝업 배경 DIV -->
    <div id="popup_mask" style="z-index: 2;"></div>
    <!-- 팝업창 -->
    <div id="popupDiv" style="z-index: 3;">

        <p class="notice"> 공지사항 </p>

        <div class="notice_mask">
            <p class="notice_">강동구 마스크 재고 알리미 오픈!<br><span style="font-size:11px; color: grey;">2020-03-16 서비스
                    시작<br>2020-03-18 송파구 서비스 오픈! (우측상단)<br>2020-03-19 하남 서비스 오픈! (우측상단)</span></p>
            <p class="notice_"> 마스크 5부제 <a
                    href="http://news.gangdong.go.kr/images/0016197178_041/1-2-1.jpg">참고</a><br><span
                    style="color:grey; font-size:11px;">출처 : 식품의약품안전처</span></p>
            <p class="notice_"> 약국별 마스크 판매시간 <a
                    href="https://view.gangdong.go.kr/SynapDocViewServer/viewer/doc.html?convType=img&convLocale=ko&contextPath=/SynapDocViewServer&key=52e8e4326ff055f70170e1dc37bb399c&pn=">참고</a><br><span
                    style="color:grey; font-size:11px;">출처 : 강동구청 사이트</span></p>
            <p class="notice_" style="font-size:11px; color:grey;"> 마스크 데이터는 실제와 10분 이상 차이가 날 수 있습니다. 약사님께 문제를 제기하지 말아
                주시기 바랍니다.
            </p>
            <p class="notice_" style="color:grey; font-size:11px;"><span style="font-weight:bold;">DB 서포터 </span><span>:
                    신홍석 이준혁 문승희 이재우</span><br><span style="font-weight:bold;">커뮤니케이션 매니저 </span><span>: 이유정 박성수 김우담</span><br><span style="font-weight:bold;">데이터 출처 </span><span>: 건강보험심사평가원</span></p>

            <p class="contact_">개발자 이메일 : hongk@kakao.com</p>
            
        </div>
        <div><button id="popupCloseBtn">닫기</button></div>
    </div>

    <ul>
        <li><a href="http://gangdong-corona.co.kr/">마스크</a></li>
        <li><a href="corona">확진자</a></li>
        <li><a href="shincheonji">신천지</a></li>
        <li id="notices" style="float:right; list-style-type:none;"><a href="hanammask">하남</a></li>
        <li id="notices" style="float:right; list-style-type:none;"><a href="songpamask">송파</a></li>
    </ul>

    <script>
        $(document).ready(function () {

            $("#popupDiv").css({
                "top": (($(window).height() - $("#popupDiv").outerHeight()) / 2 + $(window).scrollTop()) + "px",
                "left": (($(window).width() - $("#popupDiv").outerWidth()) / 2 + $(window).scrollLeft()) + "px"
                //팝업창을 가운데로 띄우기 위해 현재 화면의 가운데 값과 스크롤 값을 계산하여 팝업창 CSS 설정

            });

            $("#popup_mask").css("display", "block"); //팝업 뒷배경 display block
            $("#popupDiv").css("display", "block"); //팝업창 display block
            $("body").css("overflow", "hidden");//body 스크롤바 없애기


            $("#popupCloseBtn").click(function (event) {
                $("#popup_mask").css("display", "none"); //팝업창 뒷배경 display none
                $("#popupDiv").css("display", "none"); //팝업창 display none
            });

            //검은 막을 눌렀을 때
            $("#popup_mask").click(function () {
                $(this).hide();
                $("#popupDiv").hide();
            });

            //!!
            $("#notices").click(function () {
                $("#popup_mask").css("display", "block"); //팝업 뒷배경 display block
                $("#popupDiv").css("display", "block"); //팝업창 display block
                $("body").css("overflow", "hidden");//body 스크롤바 없애기
            });
        });

    </script>

    <div id="map" style="width:100%;height:100vh;"></div>

    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>

    <script
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=a9c8d587f5746f7c923b413fe9e46d6c&libraries=clusterer"></script>

    <script>
        $.ajax({
            method: "GET",
            url: "https://8oi9s0nnth.apigw.ntruss.com/corona19-masks/v1/storesByAddr/json",
            data: { address: "서울특별시 강동구" }
        })
            .done(function (msg) {
                for (var i = 0; i < 242; i++) {
                    console.log(msg.stores[i].name);
                    console.log(msg.stores[i].lat);
                    console.log(msg.stores[i].lng);
                    console.log(msg.stores[i].remain_stat);
                    console.log(msg.stores[i].stock_at);
                    console.log(msg.stores[i].created_at);
                    var name = msg.stores[i].name;
                    var remain = msg.stores[i].remain_stat;
                    var stock = msg.stores[i].stock_at;
                    var create = msg.stores[i].created_at;
                    var lat = msg.stores[i].lat;
                    var lng = msg.stores[i].lng;
                    var loc = new kakao.maps.LatLng(lat, lng);
                    var remove = true;

                    if (remain == "empty") {
                        var content = '<div style="color:#4267B2; text-decoration:underline; padding:10px; text-align:center; font-weight:bold">' + name + '</div> <div style="padding:10px; height:40px; width:165px; text-align:left; font-size:10px;">재고 수량 : 0개<br>입고 시간 : ' + stock + '<br>갱신 시간 : ' + create + '</div>';
                        var imageSrc = 'img/empty.png', // 마커이미지의 주소입니다    
                            imageSize = new kakao.maps.Size(40, 25), // 마커이미지의 크기입니다
                            imageOption = { offset: new kakao.maps.Point(25, 30) }; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
                        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
                    }
                    if (remain == "few") {
                        var content = '<div style="color:#4267B2; text-decoration:underline; padding:10px; text-align:center; font-weight:bold">' + name + '</div> <div style="padding:10px; height:40px; width:165px; text-align:left; font-size:10px;">재고 수량 : 2개 이상 29개 미만<br>입고 시간 : ' + stock + '<br>갱신 시간 : ' + create + '</div>';
                        var imageSrc = 'img/few.png', // 마커이미지의 주소입니다    
                            imageSize = new kakao.maps.Size(40, 25), // 마커이미지의 크기입니다
                            imageOption = { offset: new kakao.maps.Point(25, 30) }; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
                        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
                    }
                    if (remain == "some") {
                        var content = '<div style="color:#4267B2; text-decoration:underline; padding:10px; text-align:center; font-weight:bold">' + name + '</div> <div style="padding:10px; height:40px; width:165px; text-align:left; font-size:10px;">재고 수량 : 30개 이상 100개 미만<br>입고 시간 : ' + stock + '<br>갱신 시간 : ' + create + '</div>';
                        var imageSrc = 'img/some.png', // 마커이미지의 주소입니다    
                            imageSize = new kakao.maps.Size(40, 25), // 마커이미지의 크기입니다
                            imageOption = { offset: new kakao.maps.Point(25, 30) }; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
                        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
                    }
                    if (remain == "plenty") {
                        var content = '<div style="color:#4267B2; text-decoration:underline; padding:10px; text-align:center; font-weight:bold">' + name + '</div> <div style="padding:10px; height:40px; width:165px; text-align:left; font-size:10px;">재고 수량 : 100개 이상<br>입고 시간 : ' + stock + '<br>갱신 시간 : ' + create + '</div>';
                        var imageSrc = 'img/plenty.png', // 마커이미지의 주소입니다    
                            imageSize = new kakao.maps.Size(40, 25), // 마커이미지의 크기입니다
                            imageOption = { offset: new kakao.maps.Point(25, 30) }; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
                        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
                    }

                    // 마커를 생성합니다
                    var marker = new kakao.maps.Marker({
                        map: map, // 마커를 표시할 지도
                        image: markerImage,
                        position: loc, // 마커의 위치
                        clickable: true
                    });

                    // 인포윈도우를 생성하고 지도에 표시합니다
                    var infowindow = new kakao.maps.InfoWindow({
                        content: content,
                        removable: remove
                    });

                    // 마커에 mouseover 이벤트와 mouseout 이벤트를 등록합니다
                    // 이벤트 리스너로는 클로저를 만들어 등록합니다 
                    // for문에서 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
                    kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow));
                    kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                    kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
                };

                // 인포윈도우를 표시하는 클로저를 만드는 함수입니다 
                function makeOverListener(map, marker, infowindow) {
                    return function () {
                        infowindow.open(map, marker);
                    };
                }
                // 인포윈도우를 표시하는 클로저를 만드는 함수입니다 
                function makeClickListener(map, marker, infowindow) {
                    return function () {
                        infowindow.open(map, marker);
                    };
                }

                // 인포윈도우를 닫는 클로저를 만드는 함수입니다 
                function makeOutListener(infowindow) {
                    return function () {
                        infowindow.close();
                    };
                }
            });

    </script>

    <script>

        var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
            mapOption = {
                center: new kakao.maps.LatLng(37.545439, 127.142844), // 지도의 중심좌표
                level: 5 // 지도의 확대 레벨
            };
        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

        // HTML5의 geolocation으로 사용할 수 있는지 확인합니다 
        if (navigator.geolocation) {

            // GeoLocation을 이용해서 접속 위치를 얻어옵니다
            navigator.geolocation.getCurrentPosition(function (position) {

                var gpslat = position.coords.latitude, // 위도
                    gpslng = position.coords.longitude; // 경도

                var locPosition = new kakao.maps.LatLng(gpslat, gpslng); // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다

                map.setCenter(locPosition);
            });

        } else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다
            var locPosition = new kakao.maps.LatLng(37.545439, 127.142844);
        }

        // 다각형 객체를 구성할 좌표배열입니다 
        var path = [
            new kakao.maps.LatLng(38.533687, 124.245270),
            new kakao.maps.LatLng(34.617976, 124.245270),
            new kakao.maps.LatLng(34.617976, 130.617340),
            new kakao.maps.LatLng(38.533687, 130.617340)
        ];

        var hole = [
            new kakao.maps.LatLng(37.543648, 127.109066),
            new kakao.maps.LatLng(37.538463, 127.123030),
            new kakao.maps.LatLng(37.527780, 127.119058),
            new kakao.maps.LatLng(37.517409, 127.143659),
            new kakao.maps.LatLng(37.544851, 127.162813),
            new kakao.maps.LatLng(37.545290, 127.183807),
            new kakao.maps.LatLng(37.580849, 127.177264),
            new kakao.maps.LatLng(37.567341, 127.133194)
        ];

        // 다각형을 생성하고 지도에 표시합니다
        var polygon = new kakao.maps.Polygon({
            map: map,
            path: [path, hole], // 좌표 배열의 배열로 하나의 다각형을 표시할 수 있습니다
            strokeWeight: 2,
            strokeColor: '#3232FF',
            strokeOpacity: 0.7,
            fillColor: '#000000',
            fillOpacity: 0.7
        });

        // 지도에 다각형을 표시합니다
        polygon.setMap(map);

        // 마커가 지도 위에 표시되도록 설정합니다
        marker.setMap(map);

    </script>
</body>

</html>